<html>
<head>
        <script>
                function clickBtn1(){
                    const maxLength = parseInt(document.getElementById('max').value);
                    const isEnglishMode = document.getElementById('mode').value == "en";
                    const ta1 = document.getElementById('textarea1'); 
                    const ta2 = document.getElementById('textarea2'); 
                    const ta3 = document.getElementById('textarea3'); 
                    ta2.value = '';
                    ta3.value = '';

                    let sindex = 0;
                    let src = ta1.value.replace(/(\r\n|\r|\n)/g, '\n');

                    while(sindex < src.length) {
                        let buff = src.substring(sindex, sindex + maxLength);
                        let idx = buff.indexOf('\n');
                        if (idx >= 0)
                            buff = buff.substring(0, idx + 1);

                        var out = buff;
                        if (isEnglishMode && out.length == maxLength) {
                            let eindex = out.lastIndexOf(' ');
                            if (eindex > 0)
                                out = out.substring(0, eindex);
                        }

                        ta2.value += (out.trim() + "\r\n");
                        ta3.value += (out.trim().length + "\r\n");
                        sindex += out.length;
                    }
                }
                </script>

</head>
<body>
    <p>改行くん</p><br>
    <select id="mode" >
            <option value="en">英語モード</option>
            <option value="ja">日本語モード</option>
    </select>
    <input id="max" type="text" size="10" value="70" ></input>文字で折り返す<br>
    <textarea id="textarea1" cols="80" rows=25 ></textarea>
    <input type="button" value="改行" onclick="clickBtn1()"/>
    <textarea readonly id="textarea2" cols="80" rows=25 ></textarea>
    <textarea readonly id="textarea3" cols="4" rows=25 ></textarea>
</body>
</html>
